schema: v2
name: 'K8s: Nodes'

table:
  grid_items:
    - title: Available RAM
      description: Total available RAM on all nodes
      type: gauge
      metrics:
        - k8s_node_memory_available as $mem_available
      query:
        - sum($mem_available)
      columns:
        sum($mem_available):
          unit: bytes
          agg_func: last

    - title: FS available
      description: Total available filesystem on all nodes
      type: gauge
      metrics:
        - k8s_node_filesystem_available as $fs_available
      query:
        - sum($fs_available)
      columns:
        sum($fs_available):
          unit: bytes
          agg_func: last

  metrics:
    - k8s_node_cpu_utilization as $cpu_util
    - k8s_node_memory_available as $mem_available
    - k8s_node_filesystem_available as $fs_available
    - k8s_node_memory_rss as $rss_mem
    - k8s_node_memory_usage as $mem_usage
  query:
    - group by k8s_node_name
    - $cpu_util
    - $mem_usage
    - $rss_mem
    - $mem_available
    - $fs_available
  columns:
    fs_available:
      unit: bytes
    mem_available:
      unit: bytes
    mem_usage:
      unit: bytes
    rss_mem:
      unit: bytes

grid_rows:
  - title: Gauges
    items:
      - title: Available RAM
        description: Total available RAM on all nodes
        type: gauge
        metrics:
          - k8s_node_memory_available as $mem_available
        query:
          - sum($mem_available)
        columns:
          sum($mem_available):
            unit: bytes
            agg_func: last

      - title: FS available
        description: Total available filesystem on all nodes
        type: gauge
        metrics:
          - k8s_node_filesystem_available as $fs_available
        query:
          - sum($fs_available)
        columns:
          sum($fs_available):
            unit: bytes
            agg_func: last

  - title: General
    items:
      - title: CPU utilization
        chart: line
        metrics:
          - k8s_node_cpu_utilization as $cpu_util
        query:
          - $cpu_util
        columns:
          cpu_util:
            unit: utilization

      - title: RAM memory usage
        chart: line
        metrics:
          - k8s_node_memory_usage as $usage
        query:
          - $usage
        columns:
          usage:
            unit: bytes

      - title: RSS memory usage
        chart: line
        metrics:
          - k8s_node_memory_rss as $rss_mem
        query:
          - $rss_mem
        columns:
          rss_mem:
            unit: bytes

      - title: Filesystem available
        chart: line
        metrics:
          - k8s_node_filesystem_available as $fs_available
        query:
          - $fs_available
        columns:
          fs_available:
            unit: bytes

      - title: RAM available
        chart: line
        metrics:
          - k8s_node_memory_available as $mem_available
        query:
          - $mem_available
        columns:
          mem_available:
            unit: bytes

      - title: Network IO
        chart: line
        metrics:
          - k8s_node_network_io as $io
        query:
          - per_min($io)
          - group by direction
        columns:
          per_min($io):
            unit: bytes

      - title: Page faults
        chart: line
        metrics:
          - k8s_node_memory_page_faults as $page_faults
        query:
          - delta($page_faults)

      - title: Major page faults
        chart: line
        metrics:
          - k8s_node_memory_major_page_faults as $major_page_faults
        query:
          - $major_page_faults
