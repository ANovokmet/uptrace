schema: v2
name: 'System: Network devices'

table:
  grid_items:
    - title: Net devices
      description: Total number of network devices on all servers
      type: gauge
      metrics:
        - system.network.io as $net_io
      query:
        - uniq($net_io, host.name, device)

    - title: Transmit/sec
      description: Transmit bytes per minute from all servers
      type: gauge
      metrics:
        - system.network.io as $net_io
      query:
        - per_sec($net_io{direction=transmit})

    - title: Receive/sec
      description: Receive bytes per minute from all servers
      type: gauge
      metrics:
        - system.network.io as $net_io
      query:
        - per_sec($net_io{direction=receive})

    - title: Network errors
      description: Total number of errors
      type: gauge
      metrics:
        - system.network.errors as $net_errors
      query:
        - sum($net_errors)

    - title: Dropped packets
      description: Total number of dropped packets
      type: gauge
      metrics:
        - system.network.dropped as $packets_dropped
      query:
        - sum($packets_dropped)

  metrics:
    - system.network.io as $net_io
    - system.network.dropped as $packets_dropped
    - system.network.errors as $net_errors
  query:
    - group by host.name
    - group by device
    - per_sec($net_io{direction=transmit}) as transmit
    - per_sec($net_io{direction=receive}) as receive
    - per_sec($packets_dropped) as packets_dropped
    - per_sec($net_errors) as net_errors
  columns:
    net_conns: { unit: none }
    packets_dropped: { unit: none }
    net_errors: { unit: none }
    transmit: { unit: bytes }
    receive: { unit: bytes }

grid_rows:
  - title: General
    items:
      - title: Network dropped packets
        metrics:
          - system.network.dropped as $packets_dropped
        query:
          - per_sec($packets_dropped)

      - title: Network errors
        metrics:
          - system.network.errors as $net_errors
        query:
          - per_sec($net_errors)

      - title: Network transmit/receive IO
        metrics:
          - system.network.io as $net_io
        query:
          - per_sec($net_io) group by direction
        chart: stacked-area

      - title: Network transmit/receive packets
        metrics:
          - system.network.packets as $net_packets
        query:
          - per_sec($net_packets) group by direction
        chart: stacked-bar

      - title: Avg transmit/receive packet size
        metrics:
          - system.network.io as $net_io
          - system.network.packets as $net_packets
        query:
          - $net_io / $net_packets as packet_size group by direction
        columns:
          packet_size: { unit: bytes }

monitors:
  - name: Network errors
    metrics:
      - system.network.errors as $net_errors
    query:
      - $net_errors
      - group by host.name
    column: net_errors
    max_allowed_value: 0
    check_num_point: 3
